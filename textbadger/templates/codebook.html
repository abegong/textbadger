{% extends "base/document-control.html" %}
{% load tb_app_tags %}

{% block doc_classes %}
    span3
    well
    offset3
{% endblock %}

{% block start_scripts %}
<script src="{{ STATIC_URL }}jquery.tmpl.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}underscore-min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}knockout-1.2.1.js" type="text/javascript"></script>

<script src="{{ STATIC_URL }}informal/informalEditor.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}informal/informalModel.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}informal/informalScripts.js" type="text/javascript"></script>

<script type="text/javascript">
function temp_load(json){
	$.get("{{ STATIC_URL }}informal/_informalTemplateKO.htm", function(template){
//        codebookModel.questions.push( new cbQuestion("Static text", "tester", {}) );
//        codebookModel.questions.push( new cbQuestion("Multiple choice", "tester", {}) );

/*	    codebookModel.questions([
		    new cbQuestion("Static text", "", {"header_text":"<h3>Static text</h3>"} ),
		    new cbQuestion("Multiple choice", "", {} ),
		    new cbQuestion("Check all that apply", "", {} ),
		    new cbQuestion("Two-way scale", "", {} ),
		    new cbQuestion("Radio matrix", "", {} ),
		    new cbQuestion("Checkbox matrix", "", {} ),
		    new cbQuestion("Two-way matrix", "", {} ),
		    new cbQuestion("Text box", "", {} ),
		    new cbQuestion("Short essay", "", {} ),
		    new cbQuestion("Text matrix", "", {} )
	    ]);
*/
//        json = initial_codebook_model
		for( q in json ){ 
			codebookModel.questions.push( new cbQuestion(json[q].question_type, json[q].var_name, json[q].params) );
		}
        console.log(codebookModel);

		$("#doc-box").append(template);
		ko.applyBindings(codebookModel);
        console.log(codebookModel);

        $("#loading-msg").hide();

//		attachControlsToQuestion(0);
//		$("#controlAccordion").accordion({ event: "mouseover", autoHeight:true });
		//Hack to resize accordion dynamically http://jqueryui.com/demos/accordion/#option-autoHeight
//		var autoHeight = $("#controlAccordion").accordion( "option", "autoHeight" );
//        $("#controlAccordion").accordion( "option", "autoHeight", false );
	}, "text");

}

var codebook_id = "{{codebook|mongo_id}}";

$(function(){
	$.post("/ajax/get-codebook/",
        {'id': codebook_id, 'csrfmiddlewaretoken': '{{ csrf_token }}' },
        function(response){
            //! Need error checking for failed responses.
            launchInformalEditor(response.codebook.questions);
        }
    );
});
</script>
{% endblock %}

{% block title %}
<h3>{{codebook.name}}</h3>
{% endblock %}

{% block document %}
<!-- --- Codebook --- -->
<div id="loading-msg">
    <img class="tb-loading" src="{{ STATIC_URL }}ajax-loader.gif"></img>
    <p>Loading codebook...</p>
</div>
<div data-bind="template: { name: 'question-template', foreach: questions }"></div>
{% endblock %}

{% block control %}
<div class="tabbable">
  <ul class="nav nav-tabs">
    <li class="active"><a href="#tab1" data-toggle="tab">Codebook</a></li>
    <li><a href="#tab2" data-toggle="tab">Question</a></li>
  </ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab1">
      <strong>Name</strong>
      <p>{{ codebook.name }}</p>

      <strong>Description</strong>
      <p>{{ codebook.description }}</p>

      <hr/>
      {{codebook.questions}}
      
      <div id="impexpControls">
          <a class="btn" id="exportJsonButton">Export Json</a>
          <a class="btn" id="exportSelfCButton">Export HTML</a>
<!--          <a class="btn" id="loadJsonButton">Import json</a> -->
      </div>
    </div>
    <div class="tab-pane" id="tab2">
        <dl id="meta-data" class="dl-horizontal"></ul>
        <div id="sequenceControls" style="text-align:center">
            <button id="add_control"><span class="control icon-plus"></span></button>
            <button id="del_control"><span class="control icon-minus"></span></button>
            <button id="up_control"><span class="control icon-arrow-up"></span></button>
            <button id="down_control"><span class="control icon-arrow-down"></span></button>
        </div>
        <div id="questionControls"></div>
    </div>
  </div>
</div>
{% endblock %}

