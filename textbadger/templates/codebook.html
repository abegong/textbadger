{% extends "base/document-control.html" %}
{% load tb_app_tags %}

{% block start_scripts %}
<script src="{{ STATIC_URL }}jquery.tmpl.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}underscore-min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}knockout-1.2.1.js" type="text/javascript"></script>

<script src="{{ STATIC_URL }}informal/informalEditor.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}informal/informalModel.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}informal/informalScripts.js" type="text/javascript"></script>



<script type="text/javascript">
$(function(){
//    codebookModel.questions.push( new cbQuestion("Static text", "tester", {}) );
//    codebookModel.questions.push( new cbQuestion(json[q].question_type, json[q].var_name, json[q].params) );
    //var launchInformalEditor = function( initial_codebook_model ){

	$.get("{{ STATIC_URL }}informal/_informalTemplateKO.htm", function(template){
        codebookModel.questions.push( new cbQuestion("Static text", "tester", {}) );
        codebookModel.questions.push( new cbQuestion("Multiple choice", "tester", {}) );

		$("#doc-box").append(template);
		ko.applyBindings(codebookModel);
        console.log(codebookModel);
//		attachControlsToQuestion(0);
//		$("#controlAccordion").accordion({ event: "mouseover", autoHeight:true });
		//Hack to resize accordion dynamically http://jqueryui.com/demos/accordion/#option-autoHeight
//		var autoHeight = $("#controlAccordion").accordion( "option", "autoHeight" );
//        $("#controlAccordion").accordion( "option", "autoHeight", false );
	}, "text");

});
</script>
{% endblock %}

{% block title %}
<h3>{{codebook.name}}</h3>
{% endblock %}

{% block document %}
<!-- --- Codebook --- -->
<div data-bind="template: { name: 'question-template', foreach: questions }"></div>
{% endblock %}

{% block control %}
<div class="tabbable">
  <ul class="nav nav-tabs">
    <li class="active"><a href="#tab1" data-toggle="tab">Codebook</a></li>
    <li><a href="#tab2" data-toggle="tab">Question</a></li>
  </ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab1">
      <strong>Name</strong>
      <p>{{ codebook.name }}</p>

      <strong>Description</strong>
      <p>{{ codebook.description }}</p>

      <hr/>
      {{codebook.questions}}
      
      <div id="impexpControls">
          <a class="btn" id="exportJsonButton">Export json</a>
          <a class="btn" id="exportSelfCButton">Export HTML</a>
          <a class="btn" id="loadJsonButton">Import json</a>
      </div>
    </div>
    <div class="tab-pane" id="tab2">
        <dl id="meta-data" class="dl-horizontal"></ul>
        <div id="sequenceControls" style="text-align:center">
            <button id="add_control"><span class="control icon-plus"></span></button>
            <button id="del_control"><span class="control icon-minus"></span></button>
            <button id="up_control"><span class="control icon-arrow-up"></span></button>
            <button id="down_control"><span class="control icon-arrow-down"></span></button>
        </div>
        <div id="questionControls"></div>
    </div>
  </div>
</div>
{% endblock %}

