{% extends "base/single-column.html" %}
{% load tb_app_tags %}

{% block start_scripts %}
<script type="text/javascript">
function filterAll(){
    $("table#codebooks tbody tr").fadeIn();
}

function filterCurrent(){
    $("table#codebooks tbody tr:not(.current)").fadeOut();
    $("table#codebooks tbody tr.current").fadeIn();
}

function filterBatch(){
    $("table#codebooks tbody tr:not(.batches)").fadeOut();
    $("table#codebooks tbody tr.batches").fadeIn();
}

$(function(){
    //Highlight navbar
    $('a[href*="/shared-resources/"]').parent().addClass("active");

    //Set up listeners for the codebook filter dropdown
    $("#filter-menu ul li a").click(function(){
        $("#filter-menu ul li a i.icon-ok").remove();
        $(this).prepend('<i class="icon-ok"></i> ');
        eval( $(this).attr('id')+'()' );
    });

    //By default, filter to show only the current version of codebooks
    $("#filterCurrent").prepend('<i class="icon-ok"></i> ');
    $("table#codebooks tbody tr:not(.current)").hide();
    $("table#codebooks tbody tr.current").show();
});
</script>
{% endblock %}

{% block content %}

<!-- Codebooks --------------------->
<a class="btn btn-primary open-modal rightside">Create codebook</a>
{% include "forms/create-codebook.htm" %}

<h3>Codebooks</h3>
  <table id="codebooks" class="wide table-bordered">
  {% if codebooks %}
  <thead>
    <tr>
      <th>Name</th>
      <th>Version</th>
      <th>Created
<!--        <span class="badge rightside"><i class="icon-chevron-up"></i></span> -->
      </th>
      <th>
        <span class="dropdown" id="filter-menu">
          <a class="dropdown-toggle btn" data-toggle="dropdown" href="#filter-menu">
            Filter
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li><a id="filterAll" href="#">Show all</a></li>
            <li><a id="filterCurrent" href="#">Current versions only</a></li>
            <li><a id="filterBatch" href="#">With batches only</a></li>
          </ul>
        </span>
      </th>
    </tr>
  </thead>
  {% endif %}
  <tbody>
  {% for p in codebooks %}
    <tr class="{% if not p.children %}current{% endif %} {% if p.batches %}batches{% endif %}" href="/codebook/{{ p|mongo_id }}">
      <td><a href="/codebook/{{ p|mongo_id }}">{{ p.name }}</a></td>
      <td>{{ p.version }}</td>
      <td>{{ p.created_at|date_diff }}</td>
      <td>
        {% if not p.children %}<span class="badge badge-success">current</span>{% endif %}
        {% if p.batches %}<span class="badge badge-success">batches</span>{% endif %}
      </td>
    </tr>
  {% empty %}
    <tr>
      <td colspan=4><br/>You need to create a codebook to get started.<br/><br/>
      </td>
    </tr>
  {% endfor %}
  </tbody>
  </table>
<br/><br/>


<!-- Collections --------------------->
<a class="btn btn-primary open-modal rightside">Create sub-collection</a>
{% include "forms/sample-collection.htm" %}
<a class="btn btn-primary open-modal rightside">Upload collection</a>
{% include "forms/upload-collection.htm" %}

<h3>Collections</h3>
  <table class="wide table-bordered">
  {% if collections %}
  <thead>
    <tr>
      <th>Name</th>
      <th>Created</th>
      <th>Type</th>
      <th>Size</th>
    </tr>
  </thead>
  {% endif %}
  <tbody>
  {% for p in collections %}
    <tr href="/collection/{{ p|mongo_id }}">
      <td><a href="/collection/{{ p|mongo_id }}">{{ p.name }}</a></td>
      <td>{{ p.created_at }}</td>
      <td>{{ p.type }}</td>
      <td>{{ p.documents|length }}</td>
    </tr>
  {% empty %}
    <tr>
      <td colspan=4><br/>Next, you need to upload a collection of documents.<br/><br/>
      </td>
    </tr>
  {% endfor %}
  </tbody>
  </table>
<br/><br/>

<!-- Batches ------------------------->
<a class="btn btn-primary open-modal rightside">Start a batch</a>
{% include "forms/start-batch.htm" %}

<h3>Batches</h3>
  <table class="wide table-bordered">
  {% if batches %}
  <thead>
    <tr>
      <th>Project</th>
      <th>Progress</th>
    </tr>
  </thead>
  {% endif %}
  <tbody>
  {% for p in batches %}
    <tr href="/batch/{{ p|mongo_id }}">
      <td><a href="/batch/{{ p|mongo_id }}">{{ p.profile.name }}</a></td>
      <td>[...]</td>
    </tr>
  {% empty %}
    <tr>
      <td colspan=4><br/>Once you have at least one codebook and one collection, you can launch a batch.<br/><br/>
        <a href="/batch/1">temp-link: "/batch/1"</a>
      </td>
    </tr>
  {% endfor %}
  </tbody>
  </table>

<br/><br/>


{% endblock %}

